<mmd:mmd xmlns:mmd="http://www.met.no/schema/mmd" xmlns:gml="http://www.opengis.net/gml">
  <mmd:metadata_identifier>{{ data['metadata_identifier'] }}</mmd:metadata_identifier>
  {% if data['alternate_identifier'] %}
    {% for alt in data['alternate_identifier'] %}
  <mmd:alternate_identifier type="{{ alt['Identifier_type'] }}">{{ alt['Identifier'] }}</mmd:alternate_identifier>
    {% endfor %}
  {% endif %}
  <mmd:last_metadata_update>
    {% for update in data['last_metadata_update']['update'] %}
    <mmd:update>
      <mmd:datetime>{{ update['datetime'] }}</mmd:datetime>
        {% if update['type'] %}
      <mmd:type>{{ update['type'] }}</mmd:type>
        {% endif %}
        {% if update['note'] %}
      <mmd:note>{{ update['note'] }}</mmd:note>
        {% endif %}
    </mmd:update>
    {% endfor %}
  </mmd:last_metadata_update>
  <mmd:metadata_status>{{ data['metadata_status'] }}</mmd:metadata_status>
  {% for collection in data['collection'] %}
  <mmd:collection>{{ collection }}</mmd:collection>
  {% endfor %}
  {% for title in data['title'] %}
  <mmd:title xml:lang="{{ title['lang'] }}">{{ title['title'] }}</mmd:title>
  {% endfor %}
  {% for abstract in data['abstract'] %}
  <mmd:abstract xml:lang="{{ abstract['lang'] }}">{{ abstract['abstract'] }}</mmd:abstract>
  {% endfor %}
  {% for temporal_extent in data['temporal_extent'] %}
  <mmd:temporal_extent>
    <mmd:start_date>{{ temporal_extent['start_date'] }}</mmd:start_date>
    <mmd:end_date>{{ temporal_extent['end_date'] }}</mmd:end_date>
  </mmd:temporal_extent>
  {% endfor %}
  <mmd:geographic_extent>
    <mmd:rectangle srsName="{{ data['geographic_extent']['rectangle']['srsName'] }}">
      <mmd:north>{{ data['geographic_extent']['rectangle']['north'] }}</mmd:north>
      <mmd:south>{{ data['geographic_extent']['rectangle']['south'] }}</mmd:south>
      <mmd:east>{{ data['geographic_extent']['rectangle']['east'] }}</mmd:east>
      <mmd:west>{{ data['geographic_extent']['rectangle']['west'] }}</mmd:west>
    </mmd:rectangle>
    {% if data['geographic_extent']['polygon'] %}
    <mmd:polygon>
      {{ data['geographic_extent']['polygon'] }} <!-- there is large freedom in how to define a polygon, so best to use xml code from the dict -->
    </mmd:polygon>
    {% endif %}
  </mmd:geographic_extent>
  {% if data['location'] %}
    <location>
      <location_vocabulary>{{ data['location']['vocabulary'] }}</location_vocabulary>
      <location_category>{{ data['location']['continent'] }}</location_category>
      <location_type>{{ data['location']['type'] }}</location_type>
      <location_subregion1>{{ data['location']['subregion1'] }}</location_subregion1>
      <location_subregion2>{{ data['location']['subregion2'] }}</location_subregion2>
      <location_subregion3>{{ data['location']['subregion3'] }}</location_subregion3>
      <detailed_location>{{ data['location']['detailed_location'] }}</detailed_location>
    </location>
  {% endif %}
  <mmd:dataset_production_status>{{ data['dataset_production_status'] }}</mmd:dataset_production_status>
  {% if data['dataset_language'] %}
  <mmd:dataset_language>{{ data['dataset_language'] }}</mmd:dataset_language>
  {% endif %}
  {% if data['operational_status'] %}
  <mmd:operational_status>{{ data['operational_status'] }}</mmd:operational_status>
  {% endif %}
  {% if data['access_constraint'] %}
  <access_constraint>{{ data['access_constraint'] }}</access_constraint>
  {% endif %}
  {% if data['use_constraint'] %}
  <mmd:use_constraint>
    <mmd:identifier>{{ data['use_constraint']['identifier'] }}</mmd:identifier>
    <mmd:resource>{{ data['use_constraint']['resource'] }}</mmd:resource>
  </mmd:use_constraint>
  {% endif %}
  {% for personnel in data['personnel'] %}
  <mmd:personnel>
    <mmd:role>{{ personnel['role'] }}</mmd:role>
    <mmd:name>{{ personnel['name'] }}</mmd:name>
    <mmd:email>{{ personnel['email'] }}</mmd:email>
    <mmd:phone>{{ personnel['phone'] }}</mmd:phone>
    <mmd:fax>{{ personnel['fax'] }}</mmd:fax>
    <mmd:organisation>{{ personnel['organisation'] }}</mmd:organisation>
        {% if personnel['contact_address'] %}
    <mmd:contact_address>
        <mmd:address>{{ personnel['contact_address']['address'] }}</mmd:address>
        <mmd:city>{{ personnel['contact_address']['city'] }}</mmd:city>
        <mmd:province_or_state>{{ personnel['contact_address']['province_or_state'] }}</mmd:province_or_state>
        <mmd:postal_code>{{ personnel['contact_address']['postal_code'] }}</mmd:postal_code>
        <mmd:country>{{ personnel['contact_address']['country'] }}</mmd:country>
    </mmd:contact_address>
        {% endif %}
  </mmd:personnel>
  {% endfor %}
  {% if data['data_center'] %}
    {% for data_center in data['data_center'] %}
  <mmd:data_center>
    <mmd:data_center_name>
        {% if data_center['data_center_name']['short_name'] %}
      <mmd:short_name>{{ data_center['data_center_name']['short_name'] }}</mmd:short_name>
        {% endif %}
      <mmd:long_name>{{ data_center['data_center_name']['long_name'] }}</mmd:long_name>
    </mmd:data_center_name>
    <mmd:data_center_url>{{ data_center['data_center_url'] }}</mmd:data_center_url>
  </mmd:data_center>
    {% endfor %}
  {% endif %}
  {% if data['data_access'] %}
    {% for data_access in data['data_access'] %}
  <mmd:data_access>
    <mmd:type>{{ data_access['type'] }}</mmd:type>
    <mmd:resource>{{ data_access['resource'] }}</mmd:resource>
    <mmd:description>{{ data_access['description'] }}</mmd:description>
    <mmd:wms_layers>
      {% for layer in data_access['wms_layers'] %}
        <mmd:wms_layer>{{ layer }}</mmd:wms_layer>
      {% endfor %}
    </mmd:wms_layers>
  </mmd:data_access>
    {% endfor %}
  {% endif %}
  {% if data['related_dataset'] %}
    {% for related_dataset in data['related_dataset'] %}
    <mmd:related_dataset relation_type="{{ related_dataset['relation_type'] }}">{{ related_dataset['id'] }}</mmd:related_dataset>
    {% endfor %}
  {% endif %}
  {% if data['storage_information'] %}
  <mmd:storage_information>
    <mmd:file_name>{{ data['storage_information']['file_name'] }}</mmd:file_name>
    <mmd:file_location>{{ data['storage_information']['file_location'] }}</mmd:file_location>
    <mmd:file_format>{{ data['storage_information']['file_format'] }}</mmd:file_format>
    <mmd:file_size unit="{{ data['storage_information']['file_size_unit'] }}">{{
        data['storage_information']['file_size'] }}</mmd:file_size>
    <mmd:checksum type="{{ data['storage_information']['checksum_type'] }}">{{
        data['storage_information']['checksum_type'] }}
    </mmd:checksum>
  </mmd:storage_information>
  {% endif %}
  {% if data['related_information'] %}
    {% for related_info in data['related_information'] %}
      <mmd:related_information>
        <mmd:type>{{ related_info['type'] }}</mmd:type>
        <mmd:resource>{{ related_info['resource'] }}</mmd:resource>
      </mmd:related_information>
    {% endfor %}
  {% endif %}
  {% for iso_topic_category in data['iso_topic_category'] %}
  <mmd:iso_topic_category>{{ iso_topic_category['iso_topic_category'] }}</mmd:iso_topic_category>
  {% endfor %}
  {% for keyword in data['keywords'] %}
  <mmd:keywords vocabulary="{{ keyword['vocabulary'] }}">
    <mmd:keyword>{{ keyword['keyword'] }}</mmd:keyword>
    <mmd:resource>{{ keyword['resource'] }}</mmd:resource>
    <mmd:separator>{{ keyword['separator'] }}</mmd:separator>
  </mmd:keywords>
  {% endfor %}
  {% if data['project'] %}
    {% for project in data['project'] %}
  <mmd:project>
    <mmd:short_name>{{ project['short_name'] }}</mmd:short_name>
    <mmd:long_name>{{ project['long_name'] }}</mmd:long_name>
  </mmd:project>
    {% endfor %}
  {% endif %}
  {% if data['platform'] %}
    {% for platform in data['platform'] %}
  <mmd:platform>
    <mmd:short_name>{{ platform['short_name'] }}</mmd:short_name>
    <mmd:long_name>{{ platform['long_name'] }}</mmd:long_name>
        {% if platform['resource'] %}
    <mmd:resource>{{ platform['resource'] }}</mmd:resource>
        {% endif %}
        {% if platform['orbit_relative'] %}
    <mmd:orbit_relative>{{ platform['orbit_relative'] }}</mmd:orbit_relative>
        {% endif %}
        {% if platform['orbit_absolute'] %}
    <mmd:orbit_absolute>{{ platform['orbit_absolute'] }}</mmd:orbit_absolute>
        {% endif %}
        {% if platform['orbit_direction'] %}
    <mmd:orbit_direction>{{ platform['orbit_direction'] }}</mmd:orbit_direction>
        {% endif %}
    <mmd:instrument>
      <mmd:short_name>{{ platform['short_name'] }}</mmd:short_name>
      <mmd:long_name>{{ platform['long_name'] }}</mmd:long_name>
          {% if platform['resource'] %} platform
      <mmd:resource>{{ platform['resource'] }}</mmd:resource>
          {% endif %}
          {% if platform['mode'] %} platform
      <mmd:mode>{{ platform['mode'] }}</mmd:mode>
          {% endif %}
          {% if platform['polarisation'] %} platform
      <mmd:polarisation>{{ platform['polarisation'] }}</mmd:polarisation>
          {% endif %}
          {% if platform['product_type'] %} platform
      <mmd:product_type>{{ platform['product_type'] }}</mmd:product_type>
          {% endif %}
    </mmd:instrument>
    <mmd:ancillary>
            {% if platform['cloud_coverage'] %}
        <mmd:cloud_coverage>{{ platform['cloud_coverage'] }}</mmd:cloud_coverage>
            {% endif %}
            {% if platform['scene_coverage'] %}
        <mmd:scene_coverage>{{ platform['scene_coverage'] }}</mmd:scene_coverage>
            {% endif %}
            {% if platform['timeliness'] %}
        <mmd:timeliness>{{ platform['timeliness'] }}</mmd:timeliness>
            {% endif %}
    </mmd:ancillary>
  </mmd:platform>
    {% endfor %}
  {% endif %}
  {% if data['activity_type'] %}
      {% for activity_type in data['activity_type'] %}
  <mmd:activity_type>activity_type</mmd:activity_type>
      {% endfor %}
  {% endif %}
  {% if data['dataset_citation'] %}
      {% for dataset_citation in data['dataset_citation'] %}
  <mmd:dataset_citation>
        {% if dataset_citation['author'] %}
    <mmd:author>{{ dataset_citation['author'] }}</mmd:author>
        {% endif %}
        {% if dataset_citation['publication_date'] %}
    <mmd:publication_date>{{ dataset_citation['publication_date'] }}</mmd:publication_date>
        {% endif %}
        {% if dataset_citation['title'] %}
    <mmd:title>{{ dataset_citation['title'] }}</mmd:title>
        {% endif %}
        {% if dataset_citation['series'] %}
    <mmd:series>{{ dataset_citation['series'] }}</mmd:series>
        {% endif %}
        {% if dataset_citation['edition'] %}
    <mmd:edition>{{ dataset_citation['edition'] }}</mmd:edition>
        {% endif %}
        {% if dataset_citation['volume'] %}
    <mmd:volume>{{ dataset_citation['volume'] }}</mmd:volume>
        {% endif %}
        {% if dataset_citation['issue'] %}
    <mmd:issue>{{ dataset_citation['issue'] }}</mmd:issue>
        {% endif %}
        {% if dataset_citation['publication_place'] %}
    <mmd:publication_place>{{ dataset_citation['publication_place'] }}</mmd:publication_place>
        {% endif %}
        {% if dataset_citation['publisher'] %}
    <mmd:publisher>{{ dataset_citation['publisher'] }}</mmd:publisher>
        {% endif %}
        {% if dataset_citation['pages'] %}
    <mmd:pages>{{ dataset_citation['pages'] }}</mmd:pages>
        {% endif %}
        {% if dataset_citation['isbn'] %}
    <mmd:isbn>{{ dataset_citation['isbn'] }}</mmd:isbn>
        {% endif %}
        {% if dataset_citation['doi'] %}
    <mmd:doi>{{ dataset_citation['doi'] }}</mmd:doi>
        {% endif %}
        {% if dataset_citation['url'] %}
    <mmd:url>{{ dataset_citation['url'] }}</mmd:url>
        {% endif %}
        {% if dataset_citation['other'] %}
    <mmd:other>{{ dataset_citation['other'] }}</mmd:other>
        {% endif %}
  </mmd:dataset_citation>
      {% endfor %}
  {% endif %}
</mmd:mmd>
